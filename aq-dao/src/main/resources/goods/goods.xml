<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="aq.dao.goods.GoodsDao">

    <!--查询商品-->
    <select id="selectGoods" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT
        XGM.ID AS id,
        XGM. CODE AS CODE,
        XGM.SHOP_ID AS shopId,
        XSM. NAME AS shopName,
        XGM. NAME AS name,
        XGM.BAN_PRICE AS banPrice,
        XGM.BRAND_ID AS brandId,
        XB. NAME AS brandName,
        XGM.CLASSIFY_ID AS classifyId,
        XC. NAME AS classifyName,
        XGM.MODEL AS model,
        XGM.UNIT AS unit,
        sc. NAME AS unitName,
        XGM.LOGISTCS AS logistcs,
        XGM. STATUS AS status,
        XGM.SPEC_PARAMETER AS specParameter,
        (
        CASE
        WHEN SK.CURRENT_STOCK IS NULL THEN
        0
        ELSE
        SK.CURRENT_STOCK
        END
        ) AS currentStock,
        (
        CASE
        WHEN SK.USEABLE_STOCK IS NULL THEN
        0
        ELSE
        SK.USEABLE_STOCK
        END
        ) AS useableStock,
        XGM.REMARKS AS remarks,
        XGM.CREATE_USER AS createUserId,
        cu.NICK_NAME AS createUserName,
        XGM.LAST_CREATE_USER AS lastCreateUserId,
        lcu.NICK_NAME AS lastCreateUserName,
        DATE_FORMAT(
        XGM.CREATE_TIME,
        '%Y-%m-%d %H:%i:%S'
        ) AS createTime,
        DATE_FORMAT(
        XGM.LAST_CREATE_TIME,
        '%Y-%m-%d %H:%i:%S'
        ) AS lastcreateTime
        FROM
        XH_GOODS_MAIN XGM
        LEFT JOIN XH_STOCK_MAIN SK ON SK.BASIC_ID = XGM.ID
        LEFT JOIN XH_SHOPS_MAIN XSM ON XSM.ID = XGM.SHOP_ID
        LEFT JOIN XH_BRAND XB ON XB.ID = XGM.BRAND_ID
        LEFT JOIN XH_CLASSIFY XC ON XC.ID = XGM.CLASSIFY_ID
        LEFT JOIN system_config sc ON sc.KEY_WORD = XGM.UNIT
        LEFT JOIN system_administrator cu ON cu.ID = XGM.CREATE_USER
        LEFT JOIN system_administrator lcu ON lcu.ID = XGM.LAST_CREATE_USER
        WHERE 1=1
        <if test="model != null">
            AND XGM.MODEL = #{model}
        </if>
        <if test="isDel != null">
            AND XGM.IS_DELETE = #{isDel}
        </if>
        <if test="id != null">
            AND XGM.ID = #{id}
        </if>
        <if test="brandId != null">
            AND XGM.BRAND_ID = #{brandId}
        </if>
        <if test="name != null">
            AND XGM. NAME = #{name}
        </if>
        ORDER BY XB.NAME DESC,XGM.LAST_CREATE_TIME DESC,XGM.MODEL DESC
    </select>

    <!--查询品牌-->
    <select id="selectBrand" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT
        XB.ID AS id,
        XB. NAME AS name,
        XB.OFFICIAL_WEBSITE AS officialWebsite,
        XB.REMARKS AS remarks,
        XB.CREATE_USER AS createUserId,
        cu.NICK_NAME AS createUserName,
        XB.LAST_CREATE_USER AS lastCreateUserId,
        lcu.NICK_NAME AS lastCreateUserName,
        DATE_FORMAT(
        XB.CREATE_TIME,
        '%Y-%m-%d %H:%i:%S'
        ) AS createTime,
        DATE_FORMAT(
        XB.LAST_CREATE_TIME,
        '%Y-%m-%d %H:%i:%S'
        ) AS lastcreateTime
        FROM
        XH_BRAND XB
        LEFT JOIN system_administrator cu ON cu.ID = XB.CREATE_USER
        LEFT JOIN system_administrator lcu ON lcu.ID = XB.LAST_CREATE_USER
        WHERE 1=1
        <if test="id != null">
            AND XB.ID = #{id}
        </if>
        ORDER BY XB.NAME DESC,XB.LAST_CREATE_TIME DESC
    </select>

    <!--添加置换车-->
    <insert id="insertReplacementCar" >
        INSERT INTO XH_REPLACEMENT_CAR
        VALUES(#{id},#{goodsId},#{parameter},#{price},#{tips},#{createUser},#{createTime,jdbcType=TIMESTAMP},#{lastCreateTime,jdbcType=TIMESTAMP})
    </insert>

    <!--查询置换车-->
    <select id="selectReplacementCar" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT
        XAB.ID AS bllId,
        XAB.PARAMETER AS bllParameter,
        XAB.PRICE AS bllPrice,
        XAB.TIPS AS bllTips,
        XGM.ID AS goodsId,
        XGM. NAME AS goodsName,
        XGM.MODEL AS model,
        XGM.SPEC_PARAMETER AS goodsParameter,
        su.ID AS userId,
        su.NICK_NAME AS nickName,
        DATE_FORMAT(
        XAB.CREATE_TIME,
        '%Y-%m-%d %H:%i:%S'
        ) AS createTime,
        DATE_FORMAT(
        XAB.LAST_CREATE_TIME,
        '%Y-%m-%d %H:%i:%S'
        ) AS lastcreateTime
        FROM
        XH_REPLACEMENT_CAR XAB
        LEFT JOIN XH_GOODS_MAIN XGM ON XGM.ID = XAB.GOODS_ID
        LEFT JOIN system_user su ON su.OPENID = XAB.CREATE_USER
        <if test="id != null">
            AND XAB.ID = #{id}
        </if>
        <if test="openId != null">
            AND XAB.CREATE_USER = #{openId}
        </if>
        <if test="model != null">
            AND XGM.MODEL = #{model}
        </if>
        ORDER BY XAB.LAST_CREATE_TIME DESC
    </select>

    <!--更新置换车-->
    <update id="updateReplacementCar" parameterType="java.util.Map">
        UPDATE XH_REPLACEMENT_CAR XAB
        <trim prefix="set" suffixOverrides=",">
            <if test="parameter!=null and parameter != ''">
                XAB.PARAMETER = #{parameter},
            </if>
            <if test="price!=null and price != ''">
                XAB.PRICE = #{price},
            </if>
            <if test="tips!=null and tips != ''">
                XAB.TIPS = #{tips},
            </if>
            <if test="lastCreateTime!=null and lastCreateTime != ''">
                XAB.LAST_CREATE_TIME = #{lastCreateTime,jdbcType=TIMESTAMP},
            </if>
        </trim>
        WHERE XAB.ID = #{id}
    </update>

    <!--删除置换车-->
    <delete id="deleteReplacementCar"  parameterType="java.util.Map" >
        DELETE FROM XH_REPLACEMENT_CAR WHERE ID = #{id}
    </delete>

</mapper>