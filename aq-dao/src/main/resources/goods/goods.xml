<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="aq.dao.goods.GoodsDao">

    <!--添加商品-->
    <insert id="insertGoods" >
        INSERT INTO XH_GOODS_MAIN
        VALUES(#{id},#{code},#{outCode},#{shopId},#{name},#{alias},#{banPrice},#{brandId},#{classifyId},#{unit},
        #{logistcs},'02',#{specParameter},#{parameter},#{detail},#{remarks},'Y','','','','',
        #{createUserId},#{createTime,jdbcType=TIMESTAMP},#{lastCreateUserId},#{lastCreateTime,jdbcType=TIMESTAMP})
    </insert>

    <!--查询商品-->
    <select id="selectGoods" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT
        XGM.ID AS id,
        XGM. CODE AS code,
        XGM.SHOP_ID AS shopId,
        XSM. NAME AS shopName,
        XGM. NAME AS name,
        XGM.BAN_PRICE AS banPrice,
        XGM.BRAND_ID AS brandId,
        XB. NAME AS brandName,
        XGM.CLASSIFY_ID AS classifyId,
        XC. NAME AS classifyName,
        XC.MODEL AS model,
        XGM.UNIT AS unit,
        sc. NAME AS unitName,
        XGM.LOGISTCS AS logistcs,
        XGM. STATUS AS status,
        XGM.SPEC_PARAMETER AS specParameter,
        XGM.PARAMETER AS parameter,
        XGM.DETAIL AS detail,
        SK.ID AS stockId,
        XGM.LABLE AS lable,
        (
        CASE
        WHEN SK.CURRENT_STOCK IS NULL THEN
        0
        ELSE
        SK.CURRENT_STOCK
        END
        ) AS currentStock,
        (
        CASE
        WHEN SK.USEABLE_STOCK IS NULL THEN
        0
        ELSE
        SK.USEABLE_STOCK
        END
        ) AS useableStock,
        XGM.REMARKS AS remarks,
        XGM.CREATE_USER AS createUserId,
        cu.NICK_NAME AS createUserName,
        XGM.LAST_CREATE_USER AS lastCreateUserId,
        lcu.NICK_NAME AS lastCreateUserName,
        DATE_FORMAT(
        XGM.CREATE_TIME,
        '%Y-%m-%d %H:%i:%S'
        ) AS createTime,
        DATE_FORMAT(
        XGM.LAST_CREATE_TIME,
        '%Y-%m-%d %H:%i:%S'
        ) AS lastCreateTime
        FROM
        XH_GOODS_MAIN XGM
        LEFT JOIN XH_STOCK_MAIN SK ON SK.BASIC_ID = XGM.ID
        LEFT JOIN XH_SHOPS_MAIN XSM ON XSM.ID = XGM.SHOP_ID
        LEFT JOIN XH_BRAND XB ON XB.ID = XGM.BRAND_ID
        LEFT JOIN XH_CLASSIFY XC ON XC.ID = XGM.CLASSIFY_ID
        LEFT JOIN system_config sc ON sc.KEY_WORD = XGM.UNIT
        LEFT JOIN system_administrator cu ON cu.ID = XGM.CREATE_USER
        LEFT JOIN system_administrator lcu ON lcu.ID = XGM.LAST_CREATE_USER
        WHERE 1=1
        <if test="model != null and model != ''">
            AND XC.MODEL = #{model}
        </if>
        <if test="status != null and status != ''">
            AND XGM.STATUS = #{status}
        </if>
        <if test="isDel != null">
            AND XGM.IS_DELETE = #{isDel}
        </if>
        <if test="id != null">
            AND XGM.ID = #{id}
        </if>
        <if test="brandId != null">
            AND XGM.BRAND_ID = #{brandId}
        </if>
        <if test="classifyId != null">
            AND XGM.CLASSIFY_ID = #{classifyId}
        </if>
        <if test="lable != null">
            AND XGM.Lable ${lable}
        </if>
        <if test="shopId != null">
            AND XGM.SHOP_ID = #{shopId}
        </if>
        <if test="name != null and name != ''">
            AND XGM. NAME LIKE CONCAT('%', #{name}, '%')
        </if>
        ORDER BY XB.NAME DESC,XGM.LAST_CREATE_TIME DESC,XC.MODEL DESC
    </select>


    <!--更新商品-->
    <update id="updateGoods" parameterType="java.util.Map">
        UPDATE XH_GOODS_MAIN
        <trim prefix="set" suffixOverrides=",">
            <if test="code!=null and code!=''">
                CODE = #{code},
            </if>
            <if test="name!=null and name!=''">
                NAME = #{name},
            </if>
            <if test="banPrice!=null and banPrice!=''">
                BAN_PRICE = #{banPrice},
            </if>
            <if test="brandId!=null and brandId!=''">
                BRAND_ID = #{brandId},
            </if>
            <if test="classifyId!=null and classifyId!=''">
                CLASSIFY_ID = #{classifyId},
            </if>
            <if test="lable!=null and lable!=''">
                LABLE = #{lable},
            </if>
            <if test="unit!=null and unit!=''">
                UNIT = #{unit},
            </if>
            <if test="logistcs!=null and logistcs!=''">
                LOGISTCS = #{logistcs},
            </if>
            <if test="status!=null and status!=''">
                STATUS = #{status},
            </if>
            <if test="specParameter!=null and specParameter!=''">
                SPEC_PARAMETER = #{specParameter},
            </if>
            <if test="parameter!=null and parameter!=''">
                PARAMETER = #{parameter},
            </if>
            <if test="detail!=null and detail!=''">
                DETAIL = #{detail},
            </if>
            <if test="remarks!=null and remarks!=''">
                REMARKS = #{remarks},
            </if>
            <if test="lastCreateUserId!=null and lastCreateUserId!=''">
                LAST_CREATE_USER = #{lastCreateUserId},
            </if>
            <if test="lastCreateTime!=null and lastCreateTime!=''">
                LAST_CREATE_TIME = #{lastCreateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="isDelete!=null and isDelete!=''">
                IS_DELETE = #{isDelete},
            </if>
        </trim>
        WHERE
        <if test="id!=null and id!=''">
            ID = #{id}
        </if>
        <if test="ids!=null and ids!=''">
            ID in
           <foreach collection="ids" index="index" item="item" open="(" separator="," close=")">
                  #{item}
            </foreach>
        </if>
    </update>

    <!--删除商品-->
    <delete id="deleteGoods"  parameterType="java.util.Map" >
        DELETE FROM XH_GOODS_MAIN WHERE ID = #{id}
    </delete>

    <!--查询品牌-->
    <select id="selectBrand" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT
        XB.ID AS id,
        XB. NAME AS name,
        XB.OFFICIAL_WEBSITE AS officialWebsite,
        XB.REMARKS AS remarks,
        XB.CREATE_USER AS createUserId,
        cu.NICK_NAME AS createUserName,
        XB.LAST_CREATE_USER AS lastCreateUserId,
        lcu.NICK_NAME AS lastCreateUserName,
        DATE_FORMAT(
        XB.CREATE_TIME,
        '%Y-%m-%d %H:%i:%S'
        ) AS createTime,
        DATE_FORMAT(
        XB.LAST_CREATE_TIME,
        '%Y-%m-%d %H:%i:%S'
        ) AS lastCreateTime
        FROM
        XH_BRAND XB
        LEFT JOIN system_administrator cu ON cu.ID = XB.CREATE_USER
        LEFT JOIN system_administrator lcu ON lcu.ID = XB.LAST_CREATE_USER
        WHERE 1=1
        <if test="id != null">
            AND XB.ID = #{id}
        </if>
        ORDER BY XB.NAME DESC,XB.LAST_CREATE_TIME DESC
    </select>

    <!--添加置换车-->
    <insert id="insertReplacementCar" >
        INSERT INTO XH_REPLACEMENT_CAR
        VALUES(#{id},#{userId},#{goodsId},#{model},#{parameter},#{price},#{tips},#{createUser},#{createTime,jdbcType=TIMESTAMP},#{lastCreateTime,jdbcType=TIMESTAMP})
    </insert>

    <!--查询置换车-->
    <select id="selectReplacementCar" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT
        XAB.ID AS bllId,
        XAB.FD_MODEL AS model,
        XAB.PARAMETER AS bllParameter,
        XAB.PRICE AS bllPrice,
        XAB.TIPS AS bllTips,
        XGM.LOGISTCS AS logIstcs,
        XGM.IS_DELETE AS del,
        XGM.ID AS goodsId,
        XGM. NAME AS goodsName,
        XGM.SPEC_PARAMETER AS goodsParameter,
        XGM.BAN_PRICE AS banPrice,
        sa.FD_URL AS url,
        su.ID AS userId,
        su.NICK_NAME AS nickName,
        DATE_FORMAT(
        XAB.CREATE_TIME,
        '%Y-%m-%d %H:%i:%S'
        ) AS createTime,
        DATE_FORMAT(
        XAB.LAST_CREATE_TIME,
        '%Y-%m-%d %H:%i:%S'
        ) AS lastCreateTime
        FROM
        XH_REPLACEMENT_CAR XAB
        LEFT JOIN XH_GOODS_MAIN XGM ON XGM.ID = XAB.GOODS_ID
        LEFT JOIN system_user su ON su.OPENID = XAB.CREATE_USER
        LEFT JOIN system_attachment sa ON sa.FD_REF_ID = XGM.ID
        WHERE 1=1
        <if test="id != null">
            AND XAB.ID = #{id}
        </if>
        <if test="openId != null">
            AND XAB.CREATE_USER = #{openId}
        </if>
        <if test="ids != null">
            AND XAB.ID in
            <foreach collection="ids" index="index" item="item" open="(" separator="," close=")">
                #{item}
            </foreach>
        </if>
        GROUP BY XAB.ID
        ORDER BY XAB.LAST_CREATE_TIME DESC
    </select>

    <!--更新置换车-->
    <update id="updateReplacementCar" parameterType="java.util.Map">
        UPDATE XH_REPLACEMENT_CAR XAB
        <trim prefix="set" suffixOverrides=",">
            <if test="parameter!=null and parameter != ''">
                XAB.PARAMETER = #{parameter},
            </if>
            <if test="price!=null and price != ''">
                XAB.PRICE = #{price},
            </if>
            <if test="tips!=null and tips != ''">
                XAB.TIPS = #{tips},
            </if>
            <if test="lastCreateTime!=null and lastCreateTime != ''">
                XAB.LAST_CREATE_TIME = #{lastCreateTime,jdbcType=TIMESTAMP},
            </if>
        </trim>
        WHERE XAB.ID = #{id}
    </update>

    <!--删除置换车-->
    <delete id="deleteReplacementCar"  parameterType="java.util.Map" >
        DELETE FROM XH_REPLACEMENT_CAR WHERE ID = #{id}
    </delete>


    <!--新增品牌-->
    <insert id="insertBrand" >
        INSERT INTO XH_BRAND
        VALUES(#{id},
        #{name},
        #{official},
        #{remarks},
        #{obligate},
        #{obligate1},
        #{obligate2},
        #{createUser},
        #{createTime,jdbcType=TIMESTAMP},
        #{lastCreateUser},
        #{lastCreateTime,jdbcType=TIMESTAMP})
    </insert>


    <!--查询商品品牌-->
    <select id="selectBrandList" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT
            XB.ID AS id,
            XB.NAME AS name,
            XB.OFFICIAL_WEBSITE AS official,
            XB.REMARKS AS remarks
        FROM
            XH_BRAND XB
        WHERE 1=1
        <if test="name!=null and name != ''">
            AND XB.NAME = #{name}
        </if>
        ORDER BY XB.CREATE_TIME ASC
    </select>


    <!--更新品牌-->
    <update id="updateBrand" parameterType="java.util.Map">
        UPDATE XH_BRAND XB
        <trim prefix="set" suffixOverrides=",">
            <if test="name!=null and name != ''">
                XB.NAME = #{name},
            </if>
            <if test="official!=null and official != ''">
                XB.OFFICIAL_WEBSITE = #{official},
            </if>
            <if test="remarks!=null and remarks != ''">
                XB.REMARKS = #{remarks},
            </if>
            <if test="updateTime!=null and updateTime != ''">
                XB.LAST_CREATE_TIME = #{updateTime,jdbcType=TIMESTAMP},
            </if>
            <if test="lastCreateUser!=null and lastCreateUser != ''">
                XB.LAST_CREATE_USER = #{lastCreateUser},
            </if>
        </trim>
        WHERE XB.ID = #{id}
    </update>

    <!--删除商品品牌-->
    <delete id="deleteBrand"  parameterType="java.util.Map" >
        DELETE FROM XH_BRAND WHERE ID = #{id}
    </delete>


    <!--查询置换车-->
    <select id="selectLable" resultType="java.util.Map" parameterType="java.util.Map">
        SELECT
        XGL.ID AS id,
        XGL. NAME AS name,
        XGL.VALUE AS value,
        XGL.CREATE_USER AS createUserId,
        cu.NICK_NAME AS createUserName,
        DATE_FORMAT(
        XGL.CREATE_TIME,
        '%Y-%m-%d %H:%i:%S'
        ) AS createTime
        FROM
        XH_GOODS_LABLE XGL
        LEFT JOIN system_administrator cu ON cu.ID = XGL.CREATE_USER
        <if test="id != null">
            AND XGL.ID = #{id}
        </if>
    </select>


</mapper>